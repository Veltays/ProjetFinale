<Page x:Class="ProjetFinale.WPF.AccueilPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:utils="clr-namespace:ProjetFinale.Utils;assembly=ProjetFinale.Utils"
      Title="AccueilPage"
      Background="{DynamicResource App.Background}"
      Foreground="{DynamicResource App.Foreground}">
    <Page.Resources>
        <ResourceDictionary>
        </ResourceDictionary>
    </Page.Resources>
    <ScrollViewer Margin="20" VerticalScrollBarVisibility="Auto">
        <StackPanel>

            <!-- Message de bienvenue -->
            <Border Style="{StaticResource AccueilWelcomeCardStyle}">
                <StackPanel>
                    <TextBlock Text="🎯 TABLEAU DE BORD"
                               Style="{StaticResource AccueilMainTitleStyle}"/>
                    <TextBlock Text="Bienvenue dans votre espace fitness ! Suivez vos progrès et atteignez vos objectifs."
                               Style="{StaticResource AccueilSubtitleStyle}"/>
                </StackPanel>
            </Border>

            <!-- Section profil et objectifs -->
            <Grid Style="{StaticResource AccueilMainSectionStyle}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>

                <!-- Profil utilisateur ÉDITABLE -->
                <Border Grid.Column="0" Style="{StaticResource AccueilProfileCardStyle}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Photo de profil -->
                        <Border Grid.Column="0" Style="{StaticResource AccueilProfilePictureStyle}">
                            <TextBlock Style="{StaticResource AccueilProfileIconStyle}"/>
                        </Border>

                        <!-- Informations utilisateur -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Top">
                            <!-- Pseudo -->
                            <TextBlock Text="{Binding Pseudo}"
                                       Style="{StaticResource AccueilProfileNameStyle}"/>

                            <!-- Date d'inscription -->
                            <TextBlock Text="{Binding DateInscription, StringFormat='INSCRIT LE {0:dd/MM/yyyy}'}"
                                       Style="{StaticResource AccueilProfileDateStyle}"/>

                            <!-- Stats -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1*"/>
                                    <ColumnDefinition Width="15"/>
                                    <ColumnDefinition Width="1*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="10"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="15"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- POIDS -->
                                <StackPanel Grid.Column="0" Grid.Row="0">
                                    <TextBlock Text="POIDS :" Style="{StaticResource AccueilFieldLabelStyle}"/>
                                    <Border Style="{StaticResource AccueilEditableFieldBorderStyle}">
                                        <Grid Style="{StaticResource AccueilFieldGridStyle}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox x:Name="PoidsTextBox"
                                                     Grid.Column="0"
                                                     Text="{Binding Poids, Converter={StaticResource WeightConverter}, UpdateSourceTrigger=PropertyChanged}"
                                                     Style="{StaticResource AccueilEditableTextBoxStyle}"/>
                                            <!-- unité dynamique depuis App.xaml -->
                                            <TextBlock Grid.Column="1"
                                                     Text="{Binding Source={x:Static utils:SettingsContext.Instance}, Path=WeightUnit}"
                                                       Style="{StaticResource AccueilFieldUnitStyle}"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>

                                <!-- TAILLE -->
                                <StackPanel Grid.Column="2" Grid.Row="0">
                                    <TextBlock Text="TAILLE :" Style="{StaticResource AccueilFieldLabelStyle}"/>
                                    <Border Style="{StaticResource AccueilEditableFieldBorderStyle}">
                                        <Grid Style="{StaticResource AccueilFieldGridStyle}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox x:Name="TailleTextBox"
         Grid.Column="0"
         Text="{Binding Taille, Converter={StaticResource HeightConverter}, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource AccueilEditableTextBoxStyle}"/>

                                            <TextBlock Grid.Column="1"
           Text="{Binding Source={x:Static utils:SettingsContext.Instance}, Path=HeightUnit}"
           Style="{StaticResource AccueilFieldUnitStyle}"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>

                                <!-- IMC -->
                                <StackPanel Grid.Column="0" Grid.Row="2">
                                    <TextBlock Text="IMC :" Style="{StaticResource AccueilFieldLabelStyle}"/>
                                    <Border Style="{StaticResource AccueilReadOnlyFieldBorderStyle}">
                                        <TextBlock Text="{Binding IMCFormate}" Style="{StaticResource AccueilIMCValueStyle}"/>
                                    </Border>
                                </StackPanel>

                                <!-- ÂGE -->
                                <StackPanel Grid.Column="2" Grid.Row="2">
                                    <TextBlock Text="ÂGE :" Style="{StaticResource AccueilFieldLabelStyle}"/>
                                    <Border Style="{StaticResource AccueilEditableFieldBorderStyle}">
                                        <Grid Style="{StaticResource AccueilFieldGridStyle}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox x:Name="AgeTextBox"
                                                     Grid.Column="0"
                                                     Text="{Binding Age, UpdateSourceTrigger=PropertyChanged}"
                                                     Style="{StaticResource AccueilEditableTextBoxStyle}"/>
                                            <TextBlock Grid.Column="1" Text="ANS" Style="{StaticResource AccueilFieldUnitStyle}"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>

                                <!-- SAUVEGARDER PROFIL -->
                                <Button Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="3"
                                        Content="💾 SAUVEGARDER PROFIL"
                                        Style="{StaticResource AccueilSaveButtonStyle}"
                                        Click="SauvegarderProfil_Click"/>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Objectifs -->
                <Border Grid.Column="1" Style="{StaticResource AccueilObjectifsCardStyle}">
                    <StackPanel>
                        <TextBlock Text="{Binding DateObjectifFormatee, StringFormat='🎯 OBJECTIF {0}'}"
                                   Style="{StaticResource AccueilObjectifsTitleStyle}"/>

                        <!-- POIDS VISÉ -->
                        <StackPanel Style="{StaticResource AccueilObjectifsFieldStyle}">
                            <TextBlock Text="POIDS VISÉ :" Style="{StaticResource AccueilObjectifsLabelStyle}"/>
                            <Border Style="{StaticResource AccueilObjectifsInputBorderStyle}">
                                <Grid Style="{StaticResource AccueilObjectifsInputGridStyle}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="ObjectifPoidsTextBox"
         Grid.Column="0"
         Text="{Binding ObjectifPoids, Converter={StaticResource WeightConverter}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
         Style="{StaticResource AccueilEditableTextBoxStyle}"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding Source={x:Static utils:SettingsContext.Instance}, Path=WeightUnit}"
                                               Style="{StaticResource AccueilObjectifsUnitStyle}"/>
                                </Grid>
                            </Border>
                        </StackPanel>

                        <!-- IMC VISÉ -->
                        <StackPanel Style="{StaticResource AccueilObjectifsFieldStyle}">
                            <TextBlock Text="IMC VISÉ :" Style="{StaticResource AccueilObjectifsLabelStyle}"/>
                            <Border Style="{StaticResource AccueilObjectifsReadOnlyBorderStyle}">
                                <TextBlock Text="{Binding IMCObjectifFormate}" Style="{StaticResource AccueilObjectifsIMCStyle}"/>
                            </Border>
                        </StackPanel>

                        <!-- DATE OBJECTIF -->
                        <StackPanel Style="{StaticResource AccueilObjectifsFieldStyle}">
                            <TextBlock Text="DATE OBJECTIF :" Style="{StaticResource AccueilObjectifsLabelStyle}"/>
                            <Border Style="{StaticResource AccueilObjectifsDateBorderStyle}">
                                        <DatePicker x:Name="DateObjectifPicker"
                        Style="{StaticResource AccueilDatePickerStyle}"
                        SelectedDate="{Binding DateObjectif, UpdateSourceTrigger=PropertyChanged}">
                                            <DatePicker.Resources>
                                                <Style TargetType="{x:Type DatePickerTextBox}"
                           BasedOn="{StaticResource AccueilDatePickerTextBoxStyle}" />
                                            </DatePicker.Resources>
                                        </DatePicker>
                            </Border>
                        </StackPanel>

                        <!-- TEMPS RESTANT -->
                        <StackPanel Style="{StaticResource AccueilObjectifsFieldStyle}">
                            <TextBlock Text="TEMPS RESTANT :" Style="{StaticResource AccueilObjectifsLabelStyle}"/>
                            <Border Style="{StaticResource AccueilObjectifsReadOnlyBorderStyle}">
                                <TextBlock Text="{Binding AnneesRestantesFormate}" Style="{StaticResource AccueilObjectifsTimeStyle}"/>
                            </Border>
                        </StackPanel>

                        <!-- SAUVEGARDER OBJECTIFS -->
                        <Button Content="💾 SAUVEGARDER OBJECTIFS"
                                Style="{StaticResource AccueilSaveButtonStyle}"
                                Click="SauvegarderObjectifs_Click"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Actions rapides -->
            <Border Style="{StaticResource AccueilActionsCardStyle}">
                <StackPanel>
                    <TextBlock Text="⚡ ACTIONS RAPIDES"
                               Style="{StaticResource AccueilSectionTitleStyle}"/>
                    <UniformGrid Rows="1" Columns="4">
                        <Button Content="🏃 NOUVELLE SÉANCE"
                                Style="{StaticResource AccueilQuickActionButtonStyle}"
                                Click="NouvelleSeance_Click"/>
                        <Button Content="📊 VOIR PROGRÈS"
                                Style="{StaticResource AccueilQuickActionButtonStyle}"
                                Click="VoirProgres_Click"/>
                        <Button Content="🎯 MES OBJECTIFS"
                                Style="{StaticResource AccueilQuickActionButtonStyle}"
                                Click="MesObjectifs_Click"/>
                        <Button Content="📅 PLANNING"
                                Style="{StaticResource AccueilQuickActionButtonStyle}"
                                Click="Planning_Click"/>
                    </UniformGrid>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</Page>
